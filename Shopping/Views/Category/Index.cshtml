@model X.PagedList.IPagedList<ProductModel>
@using X.PagedList.Mvc.Core

@{
    ViewData["Title"] = ViewBag.Slug ?? "Danh mục sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
﻿
﻿﻿
﻿<!-- Category Header -->
﻿<div class="category-header">
﻿    <div class="container">
﻿        <h1 class="category-title text-center">
﻿            <i class="fas fa-th-large me-2"></i>
﻿            @ViewBag.Slug
﻿        </h1>
﻿        <p class="text-center mb-0 mt-2" style="font-size: 1.1rem; opacity: 0.9;">
﻿            Khám phá các sản phẩm chất lượng cao
﻿        </p>
﻿    </div>
﻿</div>
﻿
﻿<div class="container my-4">
﻿    <div class="row">
﻿        <!-- Sidebar -->
﻿        <div class="col-lg-3">
﻿            <partial name="_SidebarPartial" />
﻿        </div>
﻿
﻿        <!-- Product List -->
﻿        <div class="col-lg-9">
﻿            <!-- Filter & Sort Bar -->
﻿            <div class="filter-sort-bar">
﻿                <div class="product-count">
﻿                    <i class="fas fa-box me-2"></i>
﻿                    Tìm thấy <strong>@Model.TotalItemCount</strong> sản phẩm
﻿                </div>
﻿                <partial name="_FilterProducts" />
﻿            </div>
﻿
﻿            <!-- Products Grid -->
﻿            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
﻿                @foreach (var item in Model)
﻿                {
﻿                    <div class="col">
﻿                        <div class="card category-product-card h-100">
﻿                            <!-- Badges -->
﻿                            <div class="category-badge-container">
﻿                                @if (item.Quantity == 0)
﻿                                {
﻿                                    <span class="category-badge badge-out-stock">
﻿                                        <i class="fas fa-times-circle me-1"></i>Hết hàng
﻿                                    </span>
﻿                                }
﻿                                else if (item.Quantity < 10)
﻿                                {
﻿                                    <span class="category-badge badge-stock-low">
﻿                                        <i class="fas fa-exclamation-circle me-1"></i>Còn @item.Quantity
﻿                                    </span>
﻿                                }
﻿                                @if (item.SoldOut > 50)
﻿                                {
﻿                                    <span class="category-badge badge-hot">
﻿                                        <i class="fas fa-fire me-1"></i>Hot
﻿                                    </span>
﻿                                }
﻿                            </div>
﻿
﻿                            <!-- Action Buttons -->
﻿                            @if (User.Identity?.IsAuthenticated ?? false)
﻿                            {
﻿                                <div class="category-action-buttons">
﻿                                    <button class="category-action-btn wishlist add-btn-wishlist" data-product_id="@item.Id"
﻿                                        title="Thêm yêu thích">
﻿                                        <i class="fas fa-heart"></i>
﻿                                    </button>
﻿                                    <button class="category-action-btn compare add-btn-compare" data-product_id="@item.Id"
﻿                                        title="So sánh">
﻿                                        <i class="fas fa-exchange-alt"></i>
﻿                                    </button>
﻿                                </div>
﻿                            }
﻿
﻿                            <!-- Product Image -->
﻿                            <div class="product-image-wrapper">
﻿                                <a asp-action="Details" asp-controller="Product" asp-route-Id="@item.Id">
﻿                                    <img src="@(item.Image.StartsWith("http") ? item.Image : Url.Content("~/media/products/" + item.Image))"
﻿                                        alt="@item.Name">
﻿                                </a>
﻿                            </div>
﻿
﻿                            <!-- Product Info -->
﻿                            <div class="category-product-info">
﻿                                <h5 class="category-product-title">
﻿                                    <a asp-action="Details" asp-controller="Product" asp-route-Id="@item.Id">
﻿                                        @item.Name
﻿                                    </a>
﻿                                </h5>
﻿
﻿                                <div class="category-product-meta">
﻿                                    <span class="category-product-category">
﻿                                        <i class="fas fa-tag"></i>
﻿                                        @item.Category.Name
﻿                                    </span>
﻿                                    <span class="category-product-brand">
﻿                                        <i class="fas fa-certificate"></i>
﻿                                        @item.Brand.Name
﻿                                    </span>
﻿                                </div>
﻿
﻿                                <div class="category-product-price">
﻿                                    @string.Format(new System.Globalization.CultureInfo("vi-VN"), "{0:N0} ₫", item.Price)
﻿                                </div>
﻿
﻿                                @if (item.Quantity == 0)
﻿                                {
﻿                                    <button type="button" class="category-add-cart-btn disabled" disabled>
﻿                                        <i class="fas fa-ban"></i>
﻿                                        Hết hàng
﻿                                    </button>
﻿                                }
﻿                                else
﻿                                {
﻿                                    <button class="category-add-cart-btn primary add-to-cart" data-product_id="@item.Id">
﻿                                        <i class="fas fa-shopping-cart"></i>
﻿                                        Thêm giỏ hàng
﻿                                    </button>
﻿                                }
﻿                            </div>
﻿                        </div>
﻿                    </div>
﻿                }
﻿            </div>
﻿
﻿            @if (Model.Any())
﻿            {
﻿                <div class="d-flex justify-content-center mt-5">
﻿                    @Html.PagedListPager(Model, page => Url.Action("Index", new { slug = ViewBag.Slug, page = page }), new PagedListRenderOptions
﻿                    {
﻿                        ContainerDivClasses = new[] { "navigation" },
﻿                        LiElementClasses = new[] { "page-item" },
﻿                        PageClasses = new[] { "page-link" }
﻿                    })
﻿                </div>
﻿            }
﻿            else
﻿            {
﻿                <div class="text-center py-5">
﻿                    <i class="fas fa-box-open" style="font-size: 4rem; color: #dee2e6;"></i>
﻿                    <h4 class="mt-3 text-muted">Không tìm thấy sản phẩm nào</h4>
﻿                    <p class="text-muted">Vui lòng thử lại với danh mục khác</p>
﻿                </div>
﻿            }
﻿        </div>
﻿    </div>
﻿</div>
﻿
@section Scripts {
    <script>
        $(document).ready(function () {
            // Add to Cart, Wishlist, Compare scripts are the same as other pages
            $('.add-to-cart').click(function () {
                var id = $(this).data("product_id");
                $.ajax({

﻿                    type: "POST",
﻿                    url: "@Url.Action("Add", "Cart")",
﻿                    data: { Id: id },
﻿                    success: function (result) {
﻿                        if (result) {
﻿                            Swal.fire({
﻿                                icon: 'success',
﻿                                title: 'Thành công',
﻿                                text: 'Đã thêm sản phẩm vào giỏ hàng!',
﻿                                timer: 1500,
﻿                                showConfirmButton: false
﻿                            });
﻿                        }
﻿                    }
﻿                });
﻿            });
﻿
﻿             $('.add-btn-wishlist').click(function () {
﻿                var id = $(this).data("product_id");
﻿                $.ajax({
﻿                    type: "POST",
﻿                    url: "@Url.Action("AddWishlist", "Home")",
﻿                    data: { Id: id },
﻿                    success: function (result) {
﻿                        if (result) {
﻿                            Swal.fire({
﻿                                icon: 'success',
﻿                                title: 'Thành công',
﻿                                text: 'Đã thêm vào danh sách yêu thích!',
﻿                                timer: 1500,
﻿                                showConfirmButton: false
﻿                            });
﻿                        }
﻿                    }
﻿                });
﻿            });
﻿
﻿            $('.add-btn-compare').click(function () {
﻿                var id = $(this).data("product_id");
﻿                $.ajax({
﻿                    type: "POST",
﻿                    url: "@Url.Action("AddCompare", "Home")",
﻿                    data: { Id: id },
﻿                    success: function (result) {
﻿                        if (result) {
﻿                            Swal.fire({
﻿                                icon: 'success',
﻿                                title: 'Thành công',
﻿                                text: 'Đã thêm vào danh sách so sánh!',
﻿                                timer: 1500,
﻿                                showConfirmButton: false
﻿                            });
﻿                        }
﻿                    }
﻿                });
﻿            });
﻿        });
﻿    </script>
﻿}
﻿